![avatar](http://pythonup.cn/static/public/picture/118.png)

## 布隆过滤器

> Bloom Filter

* 当布隆过滤器说某个值存在时，这个值 可能不存在
* 当它说不存在时，那么 一定不存在

## 应用

* 大数据判断是否存在
* 解决缓存穿透
* 爬虫/ 邮箱等系统的过滤

## 原理

* 布隆过滤器 **本质上** 是由长度为 `m` 的位向量或位列表（仅包含 `0` 或 `1` 位值的列表）组成，最初所有的值均设置为 `0`
* 使用 多个 hash 函数对 key 进行运算，算得一个证书索引值，然后对位数组长度进行取模运算得到一个位置，每个 hash 函数都会算得一个不同的位置。再把位数组的这几个位置都置为 1 就完成了 add 操作
* 把这个 `key` 通过相同的多个 `hash` 函数进行运算，查看 **对应的位置** 是否 **都** 为 `1`，**只要有一个位为 `0`**，那么说明布隆过滤器中这个 `key` 不存在。如果这几个位置都是 `1`，并不能说明这个 `key` 一定存在，只能说极有可能存在，因为这些位置的 `1` 可能是因为其他的 `key` 存在导致的

## 使用

* `bf.add` 添加元素
* `bf.exists` 查询元素是否存在
* 使用 `bf.reserve` 指令显式创建

`bf.reserve` 有三个参数，分别是 `key`、`error_rate` *(错误率)* 和 `initial_size`：

- **`error_rate` 越低，需要的空间越大**，对于不需要过于精确的场合，设置稍大一些也没有关系，比如上面说的推送系统，只会让一小部分的内容被过滤掉，整体的观看体验还是不会受到很大影响的；
- **`initial_size` 表示预计放入的元素数量**，当实际数量超过这个值时，误判率就会提升，所以需要提前设置一个较大的数值避免超出导致误判率升高；

> 如果不使用 `bf.reserve`，默认的 `error_rate` 是 `0.01`，默认的 `initial_size` 是 `10`